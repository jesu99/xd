<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo de Pel√≠culas</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #buscador { margin: 10px; padding: 5px; width: 80%; max-width: 400px; }
        #peliculas { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
        .pelicula { cursor: pointer; padding: 10px; border: 1px solid #ccc; width: 200px; text-align: center; }
        .pelicula img { width: 100%; height: auto; }
        #loader { display: none; font-size: 18px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Cat√°logo de Pel√≠culas</h1>
    <input type="text" id="buscador" placeholder="Buscar pel√≠cula...">
    <p id="loader">Cargando pel√≠culas...</p>
    <div id="peliculas"></div>

    <script>
        // üí° INICIALIZACI√ìN CORRECTA DE SUPABASE (ANTES DE USARLO)
        const supabaseUrl = "https://tihvqxujcqladqxucugf.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRpaHZxeHVqY3FsYWRxeHVjdWdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDMyMDYwNTUsImV4cCI6MjA1ODc4MjA1NX0.p9lMEnhHfA10JSiGv9jJZHj0Zf5SCnZFtER5GYvqI5g"; // Reempl√°zalo con tu clave real
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        document.addEventListener("DOMContentLoaded", async () => {
            const buscador = document.getElementById("buscador");
            const peliculasContainer = document.getElementById("peliculas");
            const loader = document.getElementById("loader");

            async function cargarPeliculas(filtro = "") {
                loader.style.display = "block";
                peliculasContainer.innerHTML = "";
                
                let { data, error } = await supabase.from('peliculas').select('*');

                loader.style.display = "none";

                if (error) {
                    console.error("Error al obtener pel√≠culas:", error.message);
                    peliculasContainer.innerHTML = "<p>Error al cargar pel√≠culas.</p>";
                    return;
                }

                if (!data || data.length === 0) {
                    peliculasContainer.innerHTML = "<p>No hay pel√≠culas disponibles.</p>";
                    return;
                }

                mostrarPeliculas(data, filtro);
            }

            function mostrarPeliculas(peliculas, filtro) {
                peliculasContainer.innerHTML = peliculas
                    .filter(peli => peli.nombre.toLowerCase().includes(filtro.toLowerCase()))
                    .map(peli => `
                        <div class="pelicula" onclick="location.href='player.html?id=${peli.id}'">
                            <img src="${peli.imagen}" alt="${peli.nombre}">
                            <h3>${peli.nombre}</h3>
                            <p>${peli.resena || "Sin rese√±a disponible."}</p>
                        </div>
                    `).join('');
            }

            buscador.addEventListener("input", () => {
                cargarPeliculas(buscador.value);
            });

            await cargarPeliculas();
        });
    </script>
</body>
</html>
