<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f4f4f4;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <h2>Bienvenido</h2>
    <p id="user-email"></p>
    <p id="clicks"></p>
    <button onclick="cerrarSesion()">Cerrar Sesión</button>

    <script>
        const supabaseUrl = "https://tihvqxujcqladqxucugf.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRpaHZxeHVqY3FsYWRxeHVjdWdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDMyMDYwNTUsImV4cCI6MjA1ODc4MjA1NX0.p9lMEnhHfA10JSiGv9jJZHj0Zf5SCnZFtER5GYvqI5g";
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        async function cargarDatosUsuario() {
            const token = sessionStorage.getItem("token");
            const user_id = sessionStorage.getItem("user_id");

            if (!token || !user_id) {
                window.location.href = "login.html"; // Redirigir si no hay sesión
                return;
            }

            // Obtener información del usuario desde Supabase
            const { data, error } = await supabase
                .from("usuarios")
                .select("email, anuncios_clickeados")
                .eq("id", user_id)
                .single();

            if (error || !data) {
                console.error("Error al obtener usuario:", error);
                window.location.href = "login.html"; // Si hay error, forzar logout
                return;
            }

            document.getElementById("user-email").innerText = `Usuario: ${data.email}`;
            document.getElementById("clicks").innerText = `Anuncios clickeados: ${data.anuncios_clickeados}`;
        }

        function cerrarSesion() {
            sessionStorage.clear();
            window.location.href = "login.html";
        }

        cargarDatosUsuario();
    </script>
</body>
</html>
