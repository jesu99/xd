<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Películas</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #buscador { margin: 10px; padding: 5px; width: 80%; max-width: 400px; }
        #peliculas { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; }
        .pelicula { cursor: pointer; padding: 10px; border: 1px solid #ccc; width: 200px; text-align: center; }
        .pelicula img { width: 100%; height: auto; }
        #loader { display: none; font-size: 18px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Catálogo de Películas</h1>
    <input type="text" id="buscador" placeholder="Buscar película...">
    <p id="loader">Cargando películas...</p>
    <div id="peliculas"></div>

    <script>
        // Configuración de Supabase
        const supabaseUrl = "https://tihvqxujcqladqxucugf.supabase.co";
        const supabaseKey = "TU_SUPABASE_KEY_AQUI"; // Usa una variable de entorno en producción
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        document.addEventListener("DOMContentLoaded", async () => {
            const buscador = document.getElementById("buscador");
            const peliculasContainer = document.getElementById("peliculas");
            const loader = document.getElementById("loader");

            async function cargarPeliculas(filtro = "") {
                loader.style.display = "block";
                peliculasContainer.innerHTML = "";
                
                let { data, error } = await supabase
                    .from('peliculas')
                    .select('*')
                    .ilike('nombre', `%${filtro}%`); // Filtrar por nombre

                loader.style.display = "none";

                if (error) {
                    console.error("Error al obtener películas:", error.message);
                    peliculasContainer.innerHTML = "<p>Error al cargar películas.</p>";
                    return;
                }

                mostrarPeliculas(data);
            }

            function mostrarPeliculas(peliculas) {
                if (peliculas.length === 0) {
                    peliculasContainer.innerHTML = "<p>No se encontraron películas.</p>";
                    return;
                }

                peliculasContainer.innerHTML = peliculas.map(peli => `
                    <div class="pelicula" onclick="location.href='player.html?id=${peli.id}'">
                        <img src="${peli.imagen}" alt="${peli.nombre}">
                        <h3>${peli.nombre}</h3>
                        <p>${peli.resena || 'Sin reseña disponible'}</p>
                    </div>
                `).join('');
            }

            buscador.addEventListener("input", () => {
                cargarPeliculas(buscador.value.trim().toLowerCase());
            });

            await cargarPeliculas();
        });
    </script>
</body>
</html>
