<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Películas</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        video { 
            width: 100%; 
            max-height: 500px; 
        }
        #movieList {
            margin-top: 20px;
            border-top: 1px solid #ccc;
            padding-top: 10px;
        }
        .movie-item {
            margin-bottom: 10px;
            cursor: pointer;
            padding: 5px;
            border: 1px solid #eee;
        }
        .movie-item:hover {
            background-color: #f0f0f0;
        }
        #addMovieForm {
            margin-top: 20px;
            border-top: 1px solid #ccc;
            padding-top: 10px;
        }
        input[type="text"] {
            width: 100%;
            margin-bottom: 10px;
            padding: 5px;
        }
    </style>
</head>
<body>
    <h1>Catálogo de Películas</h1>
    
    <video id="moviePlayer" controls>
        No hay película seleccionada
    </video>

    <div id="movieList">
        <h2>Películas</h2>
    </div>

    <form id="addMovieForm">
        <h2>Agregar Nueva Película</h2>
        <input type="text" id="movieTitle" placeholder="Título de la película" required>
        <input type="text" id="hlsLink" placeholder="Enlace HLS (opcional)">
        <input type="text" id="mp4Link" placeholder="Enlace MP4 (opcional)">
        <button type="submit">Agregar Película</button>
    </form>

    <script>
        // Movie storage and management
        class MovieCatalog {
            constructor() {
                this.movies = JSON.parse(localStorage.getItem('movieCatalog')) || [];
                this.renderMovieList();
            }

            addMovie(title, hlsLink, mp4Link) {
                const movie = { title, hlsLink, mp4Link };
                this.movies.push(movie);
                this.saveMovies();
                this.renderMovieList();
            }

            saveMovies() {
                localStorage.setItem('movieCatalog', JSON.stringify(this.movies));
            }

            renderMovieList() {
                const movieList = document.getElementById('movieList');
                movieList.innerHTML = '<h2>Películas</h2>';
                
                this.movies.forEach((movie, index) => {
                    const movieItem = document.createElement('div');
                    movieItem.classList.add('movie-item');
                    movieItem.textContent = movie.title;
                    movieItem.onclick = () => this.playMovie(movie);
                    movieList.appendChild(movieItem);
                });
            }

            playMovie(movie) {
                const videoPlayer = document.getElementById('moviePlayer');
                videoPlayer.innerHTML = ''; // Clear previous sources
                
                // Reset HLS if it was previously initialized
                if (window.hls) {
                    window.hls.destroy();
                }

                // Add video sources
                if (movie.hlsLink) {
                    if (Hls.isSupported()) {
                        var hls = new Hls();
                        window.hls = hls;
                        hls.loadSource(movie.hlsLink);
                        hls.attachMedia(videoPlayer);
                        hls.on(Hls.Events.MANIFEST_PARSED, function() {
                            videoPlayer.play();
                        });
                    } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                        videoPlayer.src = movie.hlsLink;
                        videoPlayer.addEventListener('loadedmetadata', () => {
                            videoPlayer.play();
                        });
                    }
                }

                // Add MP4 source as fallback
                if (movie.mp4Link) {
                    const mp4Source = document.createElement('source');
                    mp4Source.src = movie.mp4Link;
                    mp4Source.type = 'video/mp4';
                    videoPlayer.appendChild(mp4Source);
                }

                // If no sources added, show message
                if (!movie.hlsLink && !movie.mp4Link) {
                    videoPlayer.innerHTML = 'No hay enlaces de video disponibles';
                }
            }
        }

        // Initialize catalog
        const catalog = new MovieCatalog();

        // Add initial movie from previous example
        if (catalog.movies.length === 0) {
            catalog.addMovie(
                'Película 1', 
                'https://ngr2dnwrdasv7gvg.premilkyway.com/hls2/01/03115/hovozw32wstb_,n,h,x,.urlset/index-f1-a1.m3u8?t=VHwFE2kCl3I0ejDzTVKAyoYkmmT5tNGWNezB32TyklE&s=1742761502&e=129600&f=15579442&srv=z13jtbat10fa85i&i=0.4&sp=500&p1=z13jtbat10fa85i&p2=z13jtbat10fa85i&asn=273133',
                'https://ngr2dnwrdasv7gvg.premilkyway.com/hls2/01/03115/hovozw32wstb_,n,h,x,.urlset/index-f1-a1.m3u8?t=VHwFE2kCl3I0ejDzTVKAyoYkmmT5tNGWNezB32TyklE&s=1742761502&e=129600&f=15579442&srv=z13jtbat10fa85i&i=0.4&sp=500&p1=z13jtbat10fa85i&p2=z13jtbat10fa85i&asn=273133'
            );
        }

        // Form submission handler
        document.getElementById('addMovieForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const title = document.getElementById('movieTitle').value;
            const hlsLink = document.getElementById('hlsLink').value;
            const mp4Link = document.getElementById('mp4Link').value;

            if (title) {
                catalog.addMovie(title, hlsLink, mp4Link);
                
                // Clear form inputs
                document.getElementById('movieTitle').value = '';
                document.getElementById('hlsLink').value = '';
                document.getElementById('mp4Link').value = '';
            }
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.12/hls.min.js"></script>
</body>
</html>
