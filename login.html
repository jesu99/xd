<script>
    const supabaseUrl = "https://tihvqxujcqladqxucugf.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRpaHZxeHVqY3FsYWRxeHVjdWdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDMyMDYwNTUsImV4cCI6MjA1ODc4MjA1NX0.p9lMEnhHfA10JSiGv9jJZHj0Zf5SCnZFtER5GYvqI5g";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    async function iniciarSesion() {
        const email = document.getElementById("email").value;
        const clave = document.getElementById("clave").value;
        const mensaje = document.getElementById("mensaje");

        const { data, error } = await supabase
            .from("usuarios")
            .select("id, email, clave")
            .eq("email", email)
            .single();

        if (error || !data) {
            mensaje.innerText = "Usuario no encontrado.";
            return;
        }

        if (data.clave !== clave) {
            mensaje.innerText = "Clave incorrecta.";
            return;
        }

        // Generar un token único (puede ser un UUID)
        const token = crypto.randomUUID();

        // Guardar en sessionStorage
        sessionStorage.setItem("token", token);
        sessionStorage.setItem("user_id", data.id);

        mensaje.innerText = "Inicio de sesión exitoso.";
        setTimeout(() => {
            window.location.href = "dashboard.html";
        }, 2000);
    }
</script>
